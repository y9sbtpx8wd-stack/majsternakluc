generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Category {
  STAVBAR
  ELEKTRIKAR
  KURENAR
  VODAR
  POKLADAC
  MALIAR
  INY
}

model User {
  id            Int   @id @default(uuid())
  email         String   @unique
  role          String
  passwordHash  String
  name          String?
  phone         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  profile       Profile?
  subscription  Subscription?
  ads           Ad[]
}

model Profile {
  id              String    @id @default(uuid())
  userId          String    @unique
  user            User      @relation(fields: [userId], references: [id])
  bio             String?
  skills          String[]
  experienceYears Int       @default(0)
  photoUrl        String?
  location        String?
  pricePerHour    Int?
  categories      Category[]
}

model Subscription {
  id         String   @id @default(uuid())
  userId     String   @unique
  user       User     @relation(fields: [userId], references: [id])
  plan       String
  status     String
  startDate  DateTime @default(now())
  endDate    DateTime
}

model Ad {
  id          String     @id @default(uuid())
  userId      String
  user        User       @relation(fields: [userId], references: [id])
  title       String
  summary     String
  description String
  category    Category
  location    String
  price       Int?
  isPublished Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  metrics     AdMetrics?
  reviews     Review[]   // ← doplnený opačný vzťah
}

model AdMetrics {
  id          String @id @default(uuid())
  adId        String @unique
  ad          Ad     @relation(fields: [adId], references: [id])
  adClicks    Int    @default(0)
  phoneClicks Int    @default(0)
  emailClicks Int    @default(0)
}

model Review {
  id        String   @id @default(uuid())   // ← zmenené z Int na String UUID
  rating    Int      // 1–5
  comment   String?
  adId      String                           // ← zmenené z Int na String
  ad        Ad       @relation(fields: [adId], references: [id])
  createdAt DateTime @default(now())
}
model Demand {
  id        Int      @id @default(autoincrement())
  title     String
  createdAt DateTime @default(now())
}
model Listing {
  id        Int      @id @default(autoincrement())
  title     String
  description String?
  createdAt DateTime @default(now())
}
