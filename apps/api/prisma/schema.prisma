generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Category {
  STAVBAR
  ELEKTRIKAR
  KURENAR
  VODAR
  POKLADAC
  MALIAR
  INY
}

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  role          String
  passwordHash  String
  firstName     String
  lastName      String?
  phone         String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  profile       Profile?
  subscription  Subscription?
  listings      Listing[]
  reviews       Review[]
  demands       Demand[]
}


model Profile {
  id              String    @id @default(uuid())
  userId          String    @unique
  user            User      @relation(fields: [userId], references: [id])
  bio             String?
  skills          String[]
  experienceYears Int       @default(0)
  photoUrl        String?
  location        String?
  pricePerHour    Int?
  categories      Category[]
}

model Subscription {
  id         String   @id @default(uuid())
  userId     String   @unique
  user       User     @relation(fields: [userId], references: [id])
  plan       String
  status     String
  startDate  DateTime @default(now())
  endDate    DateTime
}


model AdMetrics {
  id          String @id @default(uuid())
  adId        String @unique
  ad          Ad     @relation(fields: [adId], references: [id])
  adClicks    Int    @default(0)
  phoneClicks Int    @default(0)
  emailClicks Int    @default(0)
}

model Review {
  id        String   @id @default(uuid())
  rating    Int
  comment   String?
  listingId String
  listing   Listing  @relation(fields: [listingId], references: [id])
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
}


model Demand {
  id          String     @id @default(uuid())
  userId      String
  user        User       @relation(fields: [userId], references: [id])

  title       String
  description String?
  category    Category?
  location    String?
  isPublished Boolean    @default(true)

  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}


model Listing {
  id           String     @id @default(uuid())
  userId       String
  user         User       @relation(fields: [userId], references: [id])

  title        String
  summary      String?
  description  String?
  category     Category?
  location     String?
  price        Int?
  pricePerHour String?
  photos       String[]   @default([])

  isPublished  Boolean    @default(true)

  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  reviews      Review[]
}

model Chat {
  id           String    @id @default(cuid())
  listingId    String
  listingTitle String
  customerName String?
  customerEmail String?
  customerPhone String?
  isClosed     Boolean   @default(false)

  messages     Message[]

  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

model Message {
  id        String   @id @default(cuid())
  chatId    String
  chat      Chat     @relation(fields: [chatId], references: [id], onDelete: Cascade)
  sender    String   // 'customer' | 'craftsman' napr.
  text      String

  createdAt DateTime @default(now())
}
