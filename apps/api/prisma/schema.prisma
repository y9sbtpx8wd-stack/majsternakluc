generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Category {
  STAVBAR
  ELEKTRIKAR
  KURENAR
  VODAR
  POKLADAC
  MALIAR
  INY
}

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  role          String
  passwordHash  String
  firstName     String
  lastName      String?
  phone         String

  emailVerified Boolean  @default(false)   // ðŸ”¥ DOPLNENÃ‰
  refreshToken  String?                    // ðŸ”¥ DOPLNENÃ‰

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  profile       Profile?
  subscription  Subscription?
  listings      Listing[]
  reviews       Review[]
  demands       Demand[]
}



model Profile {
  id              String    @id @default(uuid())
  userId          String    @unique
  user            User      @relation(fields: [userId], references: [id])
  bio             String?
  skills          String[]
  experienceYears Int       @default(0)
  photoUrl        String?
  location        String?
  pricePerHour    Int?
  categories      Category[]
}

model Subscription {
  id         String   @id @default(uuid())
  userId     String   @unique
  user       User     @relation(fields: [userId], references: [id])
  plan       String
  status     String
  startDate  DateTime @default(now())
  endDate    DateTime
}


model AdMetrics {
  id          String @id @default(uuid())
  adId        String @unique
  ad          Ad     @relation(fields: [adId], references: [id])
  adClicks    Int    @default(0)
  phoneClicks Int    @default(0)
  emailClicks Int    @default(0)
}

model Review {
  id        String   @id @default(uuid())
  rating    Int
  comment   String?

  reviewerId   String
  reviewer     User     @relation(fields: [reviewerId], references: [id])

  targetUserId String?
  targetUser   User?    @relation("UserReviews", fields: [targetUserId], references: [id])

  listingId    String?   // ðŸ”¥ DOPLNENÃ‰
  listing      Listing?  @relation(fields: [listingId], references: [id]) // ðŸ”¥ DOPLNENÃ‰

  createdAt DateTime @default(now())
}




model Demand {
  id          String     @id @default(uuid())
  userId      String
  user        User       @relation(fields: [userId], references: [id])

  title       String
  description String?
  category    Category?
  location    String?
  isPublished Boolean    @default(true)

  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}


model Listing {
  id           String     @id @default(uuid())
  userId       String
  user         User       @relation(fields: [userId], references: [id])

  title        String
  summary      String?
  description  String?
  category     Category?
  location     String?
  price        Int?
  pricePerHour String?
  photos       String[]   @default([])

  isPublished  Boolean    @default(true)

  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  reviews      Review[]        // uÅ¾ mÃ¡Å¡
  stats        ListingStats?   // ðŸ”¥ DOPLNENÃ‰
  history      ListingHistory[] // ðŸ”¥ DOPLNENÃ‰
}


model Chat {
  id           String    @id @default(cuid())
  listingId    String
  listingTitle String
  customerName String?
  customerEmail String?
  customerPhone String?
  isClosed     Boolean   @default(false)

  messages     Message[]

  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

model Message {
  id        String   @id @default(cuid())
  chatId    String
  chat      Chat     @relation(fields: [chatId], references: [id], onDelete: Cascade)
  sender    String   // 'customer' | 'craftsman' napr.
  text      String

  createdAt DateTime @default(now())
}
model EmailLog {
  id        String   @id @default(uuid())
  to        String
  subject   String
  template  String
  createdAt DateTime @default(now())
}
model Invoice {
  id        String   @id @default(uuid())
  number    String
  amount    Float
  date      DateTime @default(now())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
}
model Monitoring {
  id        Int      @id @default(autoincrement())
  cpu       Int
  ram       Int
  latency   Int
  createdAt DateTime @default(now())
}
model ApiRequest {
  id        Int      @id @default(autoincrement())
  method    String
  path      String
  status    Int
  duration  Int
  time      DateTime @default(now())
}
model ErrorLog {
  id        Int      @id @default(autoincrement())
  message   String
  stack     String?
  time      DateTime @default(now())
}
model SystemEvent {
  id        Int      @id @default(autoincrement())
  event     String
  time      DateTime @default(now())
}
model ListingStats {
  listingId String   @id
  views     Int      @default(0)
  contacts  Int      @default(0)
  rating    Float    @default(0)

  listing   Listing  @relation(fields: [listingId], references: [id])
}
model ListingHistory {
  id        Int      @id @default(autoincrement())
  listingId String
  action    String
  userEmail String?
  before    Json?
  after     Json?
  createdAt DateTime @default(now())

  listing   Listing  @relation(fields: [listingId], references: [id])
}
model Report {
  id         String   @id @default(uuid())
  type       String   // listing | demand | review | user
  reason     String
  targetId   String
  status     String   @default("pending")
  createdAt  DateTime @default(now())

  reporterId String?
  reporter   User?    @relation(fields: [reporterId], references: [id])
}
